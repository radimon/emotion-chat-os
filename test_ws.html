<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>WS Test</title>
        <style>
            body { font-family: sans-serif; padding: 16px;}
            pre { background: #f5f5f5; padding: 12px; border-radius: 8px;}
        </style>
    </head>
    <body>
        <h3>WebSocket Test</h3>
        <button id="sendBtn"> Send message</button>
        <pre id="log"></pre>
        <script>
            const logEl = document.getElementById("log");
            const log = (msg) => {
                logEl.textContent += msg + "\n";
            };

            const ws = new WebSocket("ws://127.0.0.1:8000/ws/chat");

            ws.onopen = () => log("OPEN");
            ws.onmessage = (e) => log("RECV: " + e.data);
            ws.onerror = (e) => log("ERROR: " + JSON.stringify(e));
            ws.onclose = (e) => log(`CLOSE: code=${e.code} reason=${e.reason}`);

            document.getElementById("sendBtn").onclick = () => {
                const payload = {user_id: "u1", message: "我真的好累"};
                log("SEND: " + JSON.stringify(payload));
                ws.send(JSON.stringify(payload));
            };
        </script>
    </body>
</html>